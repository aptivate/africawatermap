var wwMap=function(){function y(){var e=document.getElementById("wrapperdiv");document.body.removeChild(e);var t=document.getElementById("fallback-text");t.className="show";var n=document.createElement("img");n.setAttribute("src","images/fallback.png"),document.body.appendChild(n)}function b(e){var t=e.toString().split(".");return t[0].replace(/\B(?=(\d{3})+(?!\d))/g,",")}function w(e){return e>=100?Math.round(e).toString():e.toFixed(1)}function E(e){return e.charAt(0).toUpperCase()+e.slice(1)}function S(e,t){t=typeof t=="undefined"?!1:t;if(r.hasOwnProperty(e))return t?E(r[e]):r[e];console.log("Could not find translation of "+e)}function x(e,t,n){var r=S(t,n);r&&d3.select(e).text(r)}function T(e,t,n){var r=S(t,n);r&&d3.select(e).html(r)}function N(e,t,n){var r=S(t,n);r&&d3.select(e).attr("title",r)}function C(e,t,n){var r=S(t,n);if(r){var i=d3.select(e),s=i.html();i.html(r+s.substring(s.indexOf("<")))}}function k(){x("#fallback-title","Africa Water Map"),T("#fallback-text","browser fallback"),C("#map-info-title","map info title"),C(".map-info > h1 > span.big",o),T(".instructions","instructions"),x("#select-water-source","water",!0),x("#select-sanitation-source","sanitation",!0),x("#reset-button","Reset"),C(".social-share > h2","share"),N("#twitter-search-link","follow africa water map"),N(".ss-share-link.ico-facebook","share on facebook"),N(".ss-share-link.ico-twitter","share on twitter"),N(".ss-share-link.ico-google","share on google"),N(".ss-share-link.ico-linkedin","share on linkedin"),N(".ss-share-link.ico-embed","embed this map"),C(".embed-example","you can embed this map"),x(".targets-title","Everyone, Everywhere by 2030"),x(".currently > .targets-section-title","currently"),x(".for-target > .targets-section-title","for targets"),x(".for-target > .targets-detail","extra people per year"),T(".targets-percent","That is just % of the population"),x(".map-description > h3","about this map"),x("#description-about","this map shows which ..."),x("#description-more-info > a","find out more"),x("#map-by","map by")}function L(){var e=d3.select(".embed-example");e.style("display")=="none"?e.style("display","block"):e.style("display","none")}function A(){var t=window.location!=window.parent.location?document.referrer:document.location,n=encodeURIComponent(t),r;o=="water"?r=e.twitterHashTagWater:r=e.twitterHashTagSanitation;var i=encodeURIComponent(S("twitter share text "+o)),s=encodeURIComponent(S("other share text "+o)),u=encodeURIComponent(S("Africa Water Week"));d3.select("#twitter-search-link").attr("href","https://twitter.com/#"+r).attr("title",S("follow africa water map")).attr("target","_top").text(" #"+r),d3.select(".ss-share-link.ico-facebook").attr("href","https://www.facebook.com/sharer.php?s=100&p[title]="+u+"&p[summary]="+s+"&p[url]="+n),d3.select(".ss-share-link.ico-twitter").attr("href","https://twitter.com/share?text="+i+"&url="+n+"&hashtags=africawaterweek"),d3.select(".ss-share-link.ico-google").attr("href","https://plus.google.com/share?url="+n),d3.select(".ss-share-link.ico-linkedin").attr("href","https://www.linkedin.com/shareArticle?mini=true&url="+n+"&title="+u+"&summary="+s);var a=document.getElementsByTagName("meta");for(var f=0;f<a.length;f++)a[f].getAttribute("property")=="og:description"&&(a[f].content=s),a[f].getAttribute("property")=="og:title"&&(a[f].content=u);var l=d3.select(".embed-example > pre");l.text(l.text().replace("index.html","index.html"+window.location.search))}function O(){A(),d3.select(".ss-share-link.ico-embed").on("click",L)}function M(){g.hasOwnProperty("logo")&&g.logo=="none"&&d3.select(".logos").selectAll("*").remove()}function _(){g.hasOwnProperty("social")&&g.social=="none"&&d3.select(".social-share").selectAll("*").remove()}function D(e,t,n,r,i){var s;i?s="person "+i:s="person",e.append("circle").attr("cx",t+.2*r).attr("cy",n+.15*r).attr("r",.15*r).attr("class",s),e.append("rect").attr("x",t).attr("y",n+.25*r).attr("width",.4*r).attr("height",.45*r).attr("class",s),e.append("rect").attr("x",t+.1*r).attr("y",n+.7*r).attr("width",.2*r).attr("height",.3*r).attr("class",s)}function P(e,t,n,r,i,s){for(var o=0;o<e;o++)D(t,n+o*i/2,r,i,s)}function H(e,t,n){var r,i,s;n=="current"?(r=".currently > .targets-people",i="current",s=!0):(r=".for-target > .targets-people",i="target",s=!1),e=Math.round(e),t=Math.round(t);var o=d3.select(r);o.selectAll("*").remove();var u=o.append("div"),a=parseInt(u.style("width")),f;t<=10?f=.25*a:f=.5*a;var l=.2*a,c=u.append("svg:svg").attr("id","country-targets-vis").attr("width",a).attr("height",f),h=0,p=0;s&&(e<=10?h=(10-e)*(l/2):h=(20-e)*(l/2)),e<=10?P(e,c,h,p,l,i):e<=20?(P(10,c,0,p,l,i),p=l*1.2,P(e-10,c,h,p,l,i)):console.log("Can't draw more than 20 people")}function B(t){var n=e.personFullHeight,r=n,i=n,s=d3.select("#targets-key-person");s.selectAll("*").remove();var o=s.append("svg:svg").attr("id","country-targets-vis").attr("width",r).attr("height",i);P(1,o,0,0,n,"key");var u=" = "+b(t)+" "+S("people");d3.select("#targets-key-text").text(u)}function j(e){return t.hasOwnProperty(e)&&t[e].hasOwnProperty(o+"_initial")&&t[e].hasOwnProperty(o+"_increase")?!0:!1}function F(e){return t.hasOwnProperty(e)&&t[e].hasOwnProperty(o+"_pop_current")&&t[e].hasOwnProperty(o+"_pop_universal")?!0:!1}function I(t){if(j(t)){var n=nt(i,e.maxYear);return n>99.9?-1:(100-n)/(e.maxYear-e.thisYear)}return-1}function q(e,t){maxNumber=Math.max(Math.abs(e),Math.abs(t)),minNumber=Math.min(Math.abs(e),Math.abs(t));var n={number:1e3,abbrev:S("one_letter_1000")},r={number:1e6,abbrev:S("one_letter_1000000")};return minNumber===0?maxNumber<1e6?n:r:maxNumber<1e6?n:minNumber>=1e5?r:n}function R(e,t){return e/=t.number,e<10?e.toFixed(1):Math.round(e)}function U(e,t){return maxNumber=Math.max(Math.abs(e),Math.abs(t)),maxNumber<2e4?1e3:maxNumber<2e5?1e4:maxNumber<2e6?1e5:maxNumber<2e7?1e6:1e7}function z(){d3.select(".selected-country-border").remove()}function W(){d3.select(".selected-country-border").attr("class","selected-country-border "+o)}function X(){z();var e=topojson.mesh(n,n.objects.subunits,function(e,t){return e.id==i||t.id==i});a.append("path").datum(e).attr("d",u).attr("class","selected-country-border "+o)}function V(e){j(e.id)&&(i=e.id,ht(),X())}function $(e){var t=nt(e.id,s),n=6;t!==null?t=w(t)+"%":(t="No Data",n=8);var r=tt(e.id),i=Math.max(n,r.length*.7);d3.select(".tooltip-year").text(s.toString()),d3.select(".tooltip-country").text(r),d3.select(".tooltip-percent").text(t),c.transition().duration(200).style("opacity",.9);var o=d3.select("#map")[0][0].getBoundingClientRect();c.style("width",i+"em").style("left",d3.event.pageX-o.left+10+"px").style("top",d3.event.pageY-o.top-100+"px")}function J(e){c.transition().duration(500).style("opacity",0)}function K(){d3.select("a.d3-slider-handle").text(s.toString())}function Q(){d3.select(".country-info-year").text(s.toString())}function G(){var t;o=="water"?t=e.waterColorRange:t=e.sanitationColorRange,f=d3.scale.threshold().domain(v).range(t)}function Y(){nt(i,s)===null&&(i=e.initialCountry,z())}function Z(e,t){s=t,K(),Q(),ft(),at(),dt()}function et(e){o=e,Y(),d3.select("#wrapperdiv").attr("class","wrapper "+o),ut(),at(),G(),ot(),dt(),ht(),W(),A()}function tt(e){return t.hasOwnProperty(e)?S(t[e].name):"unknown"}function nt(n,r){if(j(n)){var i=t[n][o+"_initial"],s=t[n][o+"_increase"],u=r-e.minYear;return Math.min(100,i+u*s)}return null}function rt(n,r){if(j(n)&&r>e.thisYear){var i=t[n][o+"_initial"],s=t[n][o+"_increase"],u=Math.min(100,i+s*(e.thisYear-e.minYear)),a=(100-u)/(e.maxYear-e.thisYear);return u+a*(r-e.thisYear)}return null}function it(n){if(j(n)){var r=t[n][o+"_initial"],i=t[n][o+"_increase"];return i<=0?null:Math.round((100-r)/i)+e.minYear}return null}function st(){var e={};for(var n in t)if(t.hasOwnProperty(n)){var r=nt(n,s);r!==null&&(e[n]=r)}return e}function ot(){var e=d3.select("#map-legend-svg");e.selectAll("*").remove();var t=m.length,n=parseInt(e.style("width")),r=Math.floor((n-t)/t),i=r,s=(r+1)*(t+1),u=e.append("svg").attr("width",s).attr("height",i).style("margin","auto"),a=u.selectAll("g.legend").data(m).enter().append("g").attr("class","legend");a.append("rect").attr("x",function(e,t){return(r+1)*t}).attr("y",0).attr("width",r).attr("height",i).style("fill",function(e,t){return f(e)}).style("opacity",.8),o=="water"?title=S("access to water"):title=S("access to sanitation"),d3.select("#map-legend-label").text(title)}function ut(){var t;o=="water"?(d3.select("#select-water-source").attr("class","button source current-source"),d3.select("#select-sanitation-source").attr("class","button source"),t="<br />&nbsp"):(d3.select("#select-water-source").attr("class","button source"),d3.select("#select-sanitation-source").attr("class","button source current-source"),t=""),d3.select(".map-info > h1 > span.big").attr("class","big "+o).text(S(o)).append("strong").text(" "+e.minYear.toString()+"-"+e.maxYear.toString()).append("span").html(t)}function at(){var t,n,r,u=w(nt(i,s));o=="water"?(n=S("of people have access to water - past"),r=S("of people have access to water - future"),targetText=S("of people need access to water")):(n=S("of people have access to sanitation - past"),r=S("of people have access to sanitation - future"),targetText=S("of people need access to sanitation")),s<=e.thisYear?t=n:t=r;var a=d3.select("#country-info-access-text");a.selectAll("*").remove();var f=a.append("span").attr("class","access-percentage").text(u);f.append("span").attr("class","percent-sign").text("%"),a.append("span").text(" "+t+" "),a.append("span").attr("class","in-year").text("in "+s.toString()),s>e.thisYear&&a.append("span").attr("class","actual-projected").text(" "+S("current trends")),endTrendValue=nt(i,e.maxYear),s>e.thisYear&&endTrendValue<100&&(targetValue=w(rt(i,s)),targetTextElement=a.append("p").attr("class","target-increase"),f=a.append("span").attr("class","target-percentage").text(targetValue),f.append("span").attr("class","percent-sign").text("%"),a.append("span").text(" "+targetText+" "),a.append("span").attr("class","in-year").text("in "+s.toString()),a.append("span").attr("class","achieve-targets").text(" "+S("to achieve targets")))}function ft(){d3.select(".year-line").remove(),h.append("svg:line").attr("class","year-line").attr("x1",p(s)).attr("y1",-1*d(0)).attr("x2",p(s)).attr("y2",-1*d(100))}function lt(){var t=d3.select("#country-info");t.selectAll("*").remove(),t.append("div").attr("class","country-info-year").text(s.toString()),t.append("h2").text(tt(i)),t.append("p").attr("id","country-info-access-text"),at();var n=t.append("div").attr("id","country-info-graph"),r=n.append("div").attr("class","inner"),o=parseInt(r.style("width")),u=e.lineGraphAspectRatio*o,a={left:30,right:15,top:6,bottom:20};d=d3.scale.linear().domain([0,100]).range([0+a.bottom,u-a.top]),p=d3.scale.linear().domain([e.minYear,e.maxYear]).range([0+a.left,o-a.right]);var f=r.append("svg:svg").attr("width",o).attr("height",u);h=f.append("svg:g").attr("transform","translate(0, "+u.toString()+")");var l=nt(i,e.minYear),c=nt(i,e.thisYear),v=nt(i,e.maxYear);h.append("svg:line").attr("class","history").attr("x1",p(e.minYear)).attr("y1",-1*d(l)).attr("x2",p(e.thisYear)).attr("y2",-1*d(c));if(v>99.9){var m=it(i);h.append("svg:line").attr("class","projection").attr("x1",p(e.thisYear)).attr("y1",-1*d(c)).attr("x2",p(m)).attr("y2",-1*d(100)),h.append("svg:line").attr("class","projection").attr("x1",p(m)).attr("y1",-1*d(100)).attr("x2",p(e.maxYear)).attr("y2",-1*d(100))}else h.append("svg:line").attr("class","projection").attr("x1",p(e.thisYear)).attr("y1",-1*d(c)).attr("x2",p(e.maxYear)).attr("y2",-1*d(v)),h.append("svg:line").attr("class","universal").attr("x1",p(e.thisYear)).attr("y1",-1*d(c)).attr("x2",p(e.maxYear)).attr("y2",-1*d(100));h.append("svg:line").attr("class","axis").attr("x1",p(e.minYear)).attr("y1",-1*d(0)).attr("x2",p(e.maxYear)).attr("y2",-1*d(0)),h.append("svg:line").attr("class","axis").attr("x1",p(e.minYear)).attr("y1",-1*d(0)).attr("x2",p(e.minYear)).attr("y2",-1*d(100)),h.selectAll(".xLabel").data(e.yearsOnGraph).enter().append("svg:text").attr("class","xLabel").text(String).attr("x",function(e){return p(e)}).attr("y",0).attr("text-anchor","middle"),h.selectAll(".yLabel").data(d.ticks(3)).enter().append("svg:text").attr("class","yLabel").text(String).attr("x",0).attr("y",function(e){return-1*d(e)}).attr("text-anchor","right").attr("dy",4),h.selectAll(".xTicks").data(e.yearsOnGraph).enter().append("svg:line").attr("class","xTicks").attr("x1",function(e){return p(e)}).attr("y1",-1*d(0)).attr("x2",function(e){return p(e)}).attr("y2",-1*d(-5)),h.selectAll(".yTicks").data(d.ticks(3)).enter().append("svg:line").attr("class","yTicks").attr("x1",p(e.minYear)).attr("y1",function(e){return-1*d(e)}).attr("x2",p(e.minYear-1)).attr("y2",function(e){return-1*d(e)}),ft()}function ct(){if(F(i)){var e=1e3*t[i][o+"_pop_current"],n=1e3*t[i][o+"_pop_universal"]-e;n<10&&(n=0);var r=q(e,n),s=R(e,r),u=R(n,r);d3.select(".currently .targets-number-digits").text(s),d3.select(".currently .targets-number-unit").text(r.abbrev),n>0?(d3.select(".for-target .targets-number-digits").text(u),d3.select(".for-target .targets-number-unit").text(r.abbrev)):(d3.select(".for-target .targets-number-digits").text("0"),d3.select(".for-target .targets-number-unit").text(""));var a=I(i);a>0?(d3.select(".targets-percent").style("visibility","visible"),d3.select(".targets-percent-digits").text(a.toFixed(1))):d3.select(".targets-percent").style("visibility","hidden");var f=U(e,n),l=e/f,c=n/f,h=Math.max(l,c);H(l,h,"current"),H(c,h,"target"),B(f),d3.select(".targets-key").style("visibility","visible"),o=="water"?(d3.select(".targets-subtitle").text(S("Total number of new people gaining access to water")),d3.select(".currently > .targets-detail").text(S("more people per year will gain access to water"))):(d3.select(".targets-subtitle").text(S("Total number of new people gaining access to sanitation")),d3.select(".currently > .targets-detail").text(S("more people per year will gain access to sanitation")))}else d3.select(".currently .targets-number-digits").text(""),d3.select(".currently .targets-number-unit").text("no data"),d3.select(".for-target .targets-number-digits").text(""),d3.select(".for-target .targets-number-unit").text("no data"),d3.select(".targets-percent").style("visibility","hidden"),H(0,0,"current"),H(0,0,"target"),d3.select(".targets-key").style("visibility","hidden")}function ht(){lt(),ct()}function pt(t,n){return t.hasOwnProperty(n)?f(t[n]):e.noDataColor}function dt(){var e=st();a.selectAll(".country").style("fill",function(t){return pt(e,t.id)})}function vt(){d3.select("#year-slider").selectAll("*").remove(),l=d3.select("#year-slider").call(d3.slider().axis(!0).min(e.minYear).max(e.maxYear).step(1).value(s).on("slide",Z)),K()}function mt(e,i,s,o){t=s,n=i,r=o,k();var f=topojson.feature(i,i.objects.subunits).features,l=topojson.mesh(i,i.objects.subunits,function(e,t){return!0});G(),a.selectAll(".subunit").data(f).enter().append("path").attr("d",u).attr("class",function(e){return"country "+e.id}).on("click",V).on("mouseover",$).on("mouseout",J),dt(),a.append("path").datum(l).attr("d",u).attr("class","country-border"),ot(),ht(),vt(),O(),M(),_(),c.style("opacity",0)}function gt(){i=e.initialCountry,s=e.thisYear}function yt(t){e=t;if(!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1")){y();return}o=e.initialSource,g.hasOwnProperty("source")&&(o=g.source),gt();var n=parseInt(d3.select("#map").style("width")),r=1.1,i=n*r;v=[10,20,30,40,50,60,70,80,90,101],m=[1,10,20,30,40,50,60,70,80,90,100];var s="en";g.hasOwnProperty("lang")&&(s=g.lang);var f="data/lang_"+s+".min.json",l=d3.geo.mercator().scale(n/1.25).translate([n/4,i/2+10]);u=d3.geo.path().projection(l),d3.select("#select-water-source").on("click",function(e){et("water")}),d3.select("#select-sanitation-source").on("click",function(e){et("sanitation")}),d3.select("#reset-button").on("click",bt),a=d3.select("#map").insert("svg","div.tooltip").attr("width",n).attr("height",i).attr("class","map-svg"),c=d3.select("#map > .tooltip"),queue().defer(d3.json,e.mapurl_topojson).defer(d3.json,e.dataurl).defer(d3.json,f).await(mt)}function bt(){gt(),s=e.minYear,vt(),at(),G(),ot(),dt(),ht(),z()}var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g=function(){var e={},t=window.location.search.substring(1),n=t.split("&");for(var r=0;r<n.length;r++){var i=n[r].split("=");if(typeof e[i[0]]=="undefined")e[i[0]]=i[1];else if(typeof e[i[0]]=="string"){var s=[e[i[0]],i[1]];e[i[0]]=s}else e[i[0]].push(i[1])}return e}();return{init:yt}}();